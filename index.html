<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Mis Tareas de Algoritmia y Fundamento de Programación</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins', Arial, sans-serif;
      background-color: #f3f3f3;
      padding: 20px;
      color: #333;
    }
    h1 {
      color: #1a73e8;
    }
    .tarea {
      background-color: white;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 30px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    a {
      color: #1a73e8;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
    textarea {
      width: 100%;
      border-radius: 5px;
      padding: 8px;
      margin-top: 8px;
      resize: vertical;
    }
    button {
      background-color: #1a73e8;
      color: white;
      border: none;
      padding: 8px 12px;
      margin-top: 6px;
      border-radius: 5px;
      cursor: pointer;
    }
    .comentarios {
      margin-top: 10px;
      padding-left: 10px;
      border-left: 3px solid #ccc;
    }
    .comentario-item {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      padding: 4px 0;
      gap: 8px;
    }
    .comentario-texto {
      flex-grow: 1;
    }
    .eliminar {
      background-color: transparent;
      color: red;
      border: none;
      cursor: pointer;
      font-size: 16px;
      margin-left: 10px;
    }
    .meta {
      font-size: 0.8em;
      color: gray;
      margin-bottom: 2px;
    }
    .cambiar-nombre {
      float: right;
      font-size: 0.8em;
      background-color: transparent;
      color: #1a73e8;
      border: none;
      cursor: pointer;
    }
    #nombre-actual {
      font-size: 0.9em;
      margin: 8px 0 20px 0;
      color: #444;
    }
  </style>
</head>
<body>
  <h1>
    Mis Tareas de Algoritmia y Fundamento de Programación
    <button class="cambiar-nombre" onclick="cambiarNombre()">Cambiar nombre</button>
  </h1>
  <div id="nombre-actual"></div>

  <!-- TAREAS -->
  <!-- (Contenido de las tareas permanece igual) -->
  <!-- OMITIDO PARA BREVIDAD -->

  <!-- Firebase SDKs -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-app.js";
    import { getFirestore, collection, addDoc, query, onSnapshot, where, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyB--zpdg_57jCKo-SifJRXvFM4sopD90K",
      authDomain: "comentarios-tareas.firebaseapp.com",
      projectId: "comentarios-tareas",
      storageBucket: "comentarios-tareas.appspot.com",
      messagingSenderId: "98523483833",
      appId: "1:98523483833:web:7bab4c39016b1624129568"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    function mostrarNombreActual() {
      const nombre = localStorage.getItem('nombreComentario') || 'Anónimo';
      document.getElementById('nombre-actual').textContent = `Comentando como: ${nombre}`;
    }

    if (!localStorage.getItem('nombreComentario')) {
      const nombre = prompt("Ingresa tu nombre para los comentarios:", "Profesor");
      localStorage.setItem('nombreComentario', nombre || "Anónimo");
    }

    window.cambiarNombre = function () {
      const nuevoNombre = prompt("Nuevo nombre para los comentarios:", localStorage.getItem('nombreComentario'));
      if (nuevoNombre !== null) {
        localStorage.setItem('nombreComentario', nuevoNombre || "Anónimo");
        mostrarNombreActual();
        alert("Nombre actualizado a: " + localStorage.getItem('nombreComentario'));
      }
    };

    mostrarNombreActual();

    function formatearFecha(fecha) {
      const f = new Date(fecha);
      return f.toLocaleDateString() + ' ' + f.toLocaleTimeString();
    }

    document.querySelectorAll('.tarea').forEach(tarea => {
      const tareaId = tarea.getAttribute('data-id');
      const textarea = tarea.querySelector('.comentario-input');
      const button = tarea.querySelector('.guardar-comentario');
      const comentariosDiv = tarea.querySelector('.comentarios');

      button.addEventListener('click', async () => {
        const texto = textarea.value.trim();
        if (texto) {
          const nombre = localStorage.getItem('nombreComentario') || "Anónimo";
          await addDoc(collection(db, 'comentarios'), {
            tarea: tareaId,
            texto: texto,
            fecha: new Date().toISOString(),
            autor: nombre
          });
          textarea.value = '';
        }
      });

      const q = query(collection(db, 'comentarios'), where('tarea', '==', tareaId));
      onSnapshot(q, (snapshot) => {
        comentariosDiv.innerHTML = '';
        snapshot.forEach(docSnap => {
          const data = docSnap.data();
          const contenedor = document.createElement('div');
          contenedor.className = 'comentario-item';

          const contenido = document.createElement('div');
          contenido.className = 'comentario-texto';
          const meta = document.createElement('div');
          meta.className = 'meta';
          meta.textContent = `${data.autor || 'Anónimo'} | ${formatearFecha(data.fecha)}`;
          const texto = document.createElement('p');
          texto.textContent = data.texto;
          contenido.appendChild(meta);
          contenido.appendChild(texto);

          const btnEliminar = document.createElement('button');
          btnEliminar.textContent = '🗑️';
          btnEliminar.className = 'eliminar';
          btnEliminar.onclick = async () => {
            if (confirm('¿Deseas eliminar este comentario?')) {
              await deleteDoc(doc(db, 'comentarios', docSnap.id));
            }
          };

          contenedor.appendChild(contenido);
          contenedor.appendChild(btnEliminar);
          comentariosDiv.appendChild(contenedor);
        });
      });
    });
  </script>
</body>
</html>
